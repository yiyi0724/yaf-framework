define("h/game/play",["../plugins/cookie"],function(e,t,n){$(function(){!function(e){var t=function(){var e=$(window).width(),t=$(window).height(),n=t-$("#framenav").outerHeight(!0);$("#myIframe").width(e).height(t),$("#rewardFrameWrap").width(e).height(n),$("#rewardFrame").width(e).height(n),$("#assistiveTouch").css({right:"0px",top:"140px",left:"auto"}).find(".pic").removeClass("rotate-child-left")};t(),e.addEventListener("resize",t,!1)}(window),function(){function e(e){if(e.source===t){var n=JSON.parse(e.data),i=n.method,o=n.params;"pay"==i&&o&&(o.success=function(e){function t(){$.ajax({url:"/pay/stat/",type:"GET",dataType:"json",data:{order_id:n.orderId}}).done(function(e){e.status&&e.data&&e.data.url&&(window.clearInterval(o),window.top.location.href=e.data.url)})}console.log("iframeChoosePaySuccess:"),console.log(e);var i='<div class="waiting-pay-result">                                                        <div class="inner">                                                            <p class="pic"><img src="'+PageConfig.imgUrl+'h/public/grey-loading.gif" alt="loading" /></p>                                                            <p class="tit">微信支付成功</p>                                                            <p>正在等待充值到游戏...</p>                                                        </div>                                                    </div>';$("#myIframe").contents().find("body").append(i);var o=window.setInterval(t,1e3)},wx.chooseWXPay(o))}}var t=document.getElementById("myIframe").contentWindow;window.addEventListener?window.addEventListener("message",function(t){e(t)},!1):window.attachEvent("onmessage",function(t){e(t)})}(),function(){var t=e("../plugins/cookie"),n=$("#assistiveTouch"),i=$("#sidebar"),o=($("#mainContent"),$("#redpack")),a=parseInt($("#isActivity").val(),10),r=navigator.userAgent.toLowerCase(),s=r.indexOf("youlaohu")>-1;window.manyouSidebar={init:function(){this.registerAssistiveMove(),this.countOnlineTime(),this.touchCartoonTrigger(),this.touchScroll("#sidebar",".scrollable"),n.show(),n.on("click",function(e){n.find(".tip").hide(),window.manyouSidebar.show()}),i.on("click",function(e){"modal"==e.target.className&&window.manyouSidebar.hide()}),setTimeout(function(){$("#shadeLoad").hide()},2e3),s||$("#myIframe").load(function(){t.get("exit_game_time")?t.get("exit_game_time")!=(new Date).getDay()&&window.manyouSidebar.exitGame():window.manyouSidebar.exitGame()})},show:function(){window.manyouSidebar.registerPanelControl(),window.manyouSidebar.getSidebarInfo(),i.fadeIn(200),i.find(".modal-dialog").animate({"margin-left":"0px"},200,function(){})},hide:function(){i.fadeOut(200),i.find(".modal-dialog").animate({"margin-left":"-84%"},200)},registerAssistiveMove:function(){var e=this,t=n.outerWidth(!0),i=n.outerHeight(!0);n.on({touchstart:function(t){e.keepSide&&clearTimeout(e.keepSide),n.stop(),n.removeClass("touch-side").find(".pic").removeClass("rotate-child-left");var i=t.originalEvent.targetTouches[0];touchStartX=i.clientX,touchStartY=i.clientY;var o=n.offset();assistiveTouchOriginX=o.left,assistiveTouchOriginY=o.top},touchmove:function(e){var o=$(window).width(),a=$(window).height(),r=e.originalEvent.targetTouches[0],s=r.clientX-touchStartX,c=r.clientY-touchStartY,d=assistiveTouchOriginX+s>0?assistiveTouchOriginX+s:0,u=assistiveTouchOriginY+c>0?assistiveTouchOriginY+c:0;d=d+t>o?o-t:d,u=u+i>a?a-i:u,n.offset({left:d,top:u});var l=(d+t/2)/o;.5>=l?n.find(".tip").addClass("tip-left"):n.find(".tip").removeClass("tip-left"),e.preventDefault()},touchend:function(i){var o=$(window).width(),a=n.offset(),r=a.left,s=(r+t/2)/o,c=.5>=s?0:o-t;n.css("left",n.offset().left).animate({left:c},200),e.touchCartoonTrigger()}})},touchCartoonTrigger:function(){var e=this,t=n.outerWidth(!0),i=$(window).width(),o=function(){var e=n.offset(),o=e.left,a=e.top;n.offset({left:o,top:a});var r=(o+t/2)/i,s=.5>=r?"-="+(t-28)+"px":"+="+(t-28)+"px";n.animate({left:s},200,function(){.5>=r?n.css({left:0}).addClass("touch-side").find(".pic").addClass("rotate-child-left"):n.addClass("touch-side")})};e.keepSide=setTimeout(o,2e3)},registerPanelControl:function(){function e(e){window.manyouSidebar.hide(),t.showRewardFrame(e.attr("data-src")),i.show()}var t=this,n=$("#codeBox"),i=$("#framenav");$("#saveGame").on("click",function(){n.show()}),n.on({click:function(e){var t=e.target.className;("code-box-wrap"==t||"close"==t)&&(window.manyouSidebar.hide(),n.hide())},touchmove:function(e){e.preventDefault()}}),$("#redpack").on("click","a",function(){return e($(this)),!1}),$("#sign").on("click",function(){return e($(this)),!1}),i.on("click",".return",function(){return t.removeRewardFrame(),!1})},resizeDialog:function(){i.find(".dialog-box").height($(window).height()-104)},touchScroll:function(e,t){var t=document.querySelector(e+" "+t);t.addEventListener("touchstart",function(){var e=t.scrollTop,n=t.scrollHeight,i=e+t.offsetHeight;0===e?t.scrollTop=1:i===n&&(t.scrollTop=e-1)}),t.addEventListener("touchmove",function(e){t.offsetHeight<t.scrollHeight&&(e._isScroller=!0)}),document.querySelector(e).addEventListener("touchmove",function(e){e._isScroller||e.preventDefault()})},getSidebarInfo:function(){a&&$.ajax({url:"/tg/online/get/",type:"GET",dataType:"json"}).done(function(e){var t=e.data;e.status&&($("#onlineTime").html(t.muinute),t.sign&&o.find(".sign").addClass("signed").find("a").html("已签到"))})},countOnlineTime:function(){function e(){$.ajax({url:"/tg/online/update/",type:"GET",dataType:"json"})}a&&setInterval(e,2e4)},showRewardFrame:function(e){var t=document.getElementById("rewardFrameWrap");t&&document.body.removeChild(t);var n=$(window).width(),i=$(window).height()-$("#framenav").outerHeight(!0),t=document.createElement("div");t.className="frame-wrap",t.id="rewardFrameWrap",t.style.margin="auto",t.style.minWidth="320px",t.style.width=n+"px",t.style.height=i+"px";var o=document.createElement("iframe");o.id="rewardFrame",o.className="reward-frame",o.style.minWidth="320px",o.style.display="block",o.style.verticalAlign="bottom",o.style.width=n+"px",o.style.height=i+"px",o.style.margin=0,o.style.padding=0,o.setAttribute("frameborder","0"),o.setAttribute("border","0"),o.setAttribute("marginwidth","0"),o.setAttribute("marginheight","0"),o.setAttribute("scrolling","auto"),o.src=e,document.body.appendChild(t),t.appendChild(o)},removeRewardFrame:function(){var e=document.getElementById("rewardFrameWrap");e&&document.body.removeChild(e),$("#framenav").hide()},exitGame:function(){var e=this,n=$("#exitGameBox"),i=!0;n.on("touchmove",function(e){e.preventDefault()}),n.on("click",".close, .btn-keep",function(){$(this);return n.hide(),window.history.pushState({title:document.title,url:location.href},document.title,location.href),!1}),n.on("click",".btn-leave",function(){return console.log("referrer:",document.referrer),""===document.referrer&&r.indexOf("micromessenger")>-1?wx.closeWindow():window.history.back(),!1}),n.on("click",".checkbox",function(){var n=$(this);return i?(n.addClass("checkbox-on"),t.set("exit_game_time",(new Date).getDay(),{timeFormat:"hs",expires:8760,path:"/"}),window.removeEventListener("popstate",function(){})):(n.removeClass("checkbox-on"),t.remove("exit_game_time",{path:"/"}),e.exitGameAddEvent()),i=!i,!1}),e.exitGameAddEvent()},exitGameAddEvent:function(){setTimeout(function(){"pushState"in window.history&&(window.history.pushState({title:document.title,url:location.href},document.title,location.href),window.addEventListener&&window.addEventListener("popstate",function(e){if(console.log("popstate event:",e.state),!e.state){var t=$("#exitGameBox");t.find("img").each(function(){var e=$(this);e.attr("src",e.data("src"))}),t.fadeIn(500)}}))},2e3)}},manyouSidebar.init()}(),function(){window.manyouChat={connect:function(){window.isDebug?(window.manyouChat.Config={chatAppKey:"x4vkb1qpvsrkk",chatToken:"hy07iZAUFloEjozpvstMg/kCNayJdmr1w+5mjqkz9SXdrnEI+ZaihDKa/ke2SxSaEFY3+J/nEntxJSvEY7SYWw==",chatRoomId:"test_1"},window.manyouChat.registerSend()):$.getJSON("/auth/chat?gameId=window.HORTOR_GAME_CONF.GameId&userId=window.HORTOR_CONF.UserId",function(e){window.manyouChat.Config=e,window.manyouChat.Config.chatRoomId="window.HORTOR_GAME_CONF.GameId_"+window.manyouChat.Config.chatRoomCnt,window.manyouChat.registerSend()})},registerSend:function(){$("#send").on("click",function(){window.manyouChat.handleSend()}),$mainContent.on("click",function(e){13==e.keyCode&&window.manyouChat.handleSend()})},handleSend:function(){}}}(),function(){var e={title:"游老虎"+$("#gameName").val(),desc:"无需下载，打开即玩！",link:window.location.href,imgUrl:$("#shareImgUrl").val()||PageConfig.imgUrl+"h/public/logo.png"};wx.ready(function(){wx.checkJsApi({jsApiList:["chooseWXPay","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"],success:function(e){console.log(e)}}),wx.onMenuShareTimeline({title:"游老虎"+$("#gameName").val()+"，无需下载，打开即玩！",link:e.link,imgUrl:e.imgUrl,success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:e.title,desc:e.desc,link:e.link,imgUrl:e.imgUrl,success:function(){},cancel:function(){}}),wx.onMenuShareQQ({title:e.title,desc:e.desc,link:e.link,imgUrl:e.imgUrl,success:function(){},cancel:function(){}}),wx.onMenuShareWeibo({title:e.title,desc:e.desc,link:e.link,imgUrl:e.imgUrl,success:function(){},cancel:function(){}}),wx.onMenuShareQZone({title:e.title,desc:e.desc,link:e.link,imgUrl:e.imgUrl,success:function(){},cancel:function(){}})})}()})}),define("h/plugins/cookie",[],function(e,t,n){n.exports={docu:window.document,set:function(e,t,n){n=$.extend({},n);var i=new Date;return"number"==typeof n.expires&&(n.timeFormat?"hs"===n.timeFormat&&(i.setDate(i.getDate()+parseInt(n.expires/24)),i.setHours(i.getHours()+n.expires%24)):(i.setMinutes(i.getMinutes()+parseInt(n.expires/60)),i.setSeconds(i.getSeconds()+n.expires%60))),this.docu.cookie=[e,"=",encodeURIComponent(t),n.expires?"; expires="+i.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join(""),this},get:function(e){for(var t,n=this.docu.cookie.split("; "),i=0,o=n.length;o>i;i++)if(t=n[i].split("="),t[0]===e)return decodeURIComponent(t[1]);return""},remove:function(e,t){return this.set(e,"",$.extend({},t,{expires:-1})),this}}});