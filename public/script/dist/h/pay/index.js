define("h/pay/index",["../public/tipFun","../plugins/dialog"],function(e,a,i){var o=e("../public/tipFun"),n=e("../plugins/dialog"),c=$("#payList"),t=$("#payAlipay"),s=$("#payWechat"),d=$("#payCoin"),l=$("#payRedpack"),r=$("#submitBtn"),u=$("#hidUseCoin"),p=$("#hidUseRedpackage"),h=Number($("#hidCoin").val())||0,f=Number($("#hidRedpacket").val())||0,v=Number($("#hidTotalCount").val())||0,b=Number($("#hidPayRedpackageId").val())||0,y=$("#hidOrderId").val(),x=navigator.userAgent.toLowerCase(),k={init:function(){this.registerEvent()},registerEvent:function(){var e=this;c.on("click",".pay-item",function(a){var i=$(this),o=i.find(".ui-checkbox");if(i.is("#payCoin")){if(100>h)return!1;o.toggleClass("ui-checkbox-on"),f>=v&&h>=100&&h/100>=v&&l.find(".ui-checkbox").hasClass("ui-checkbox-on")&&l.find(".ui-checkbox").removeClass("ui-checkbox-on"),h/100>=v&&e.clearThirdPay()}else if(i.is("#payRedpack")){if(!f)return!1;o.toggleClass("ui-checkbox-on"),f>=v&&h>=100&&h/100>=v&&d.find(".ui-checkbox").hasClass("ui-checkbox-on")&&d.find(".ui-checkbox").removeClass("ui-checkbox-on"),f>=v&&e.clearThirdPay()}else i.is("#payAlipay")?(o.toggleClass("ui-checkbox-on"),s.find(".ui-checkbox").removeClass("ui-checkbox-on"),o.hasClass("ui-checkbox-on")&&e.clearSelfPay()):i.is("#payWechat")&&(o.toggleClass("ui-checkbox-on"),t.find(".ui-checkbox").removeClass("ui-checkbox-on"),o.hasClass("ui-checkbox-on")&&e.clearSelfPay());return e.changePayType(),!1}),r.on("click",function(){var a="";return d.find(".ui-checkbox").hasClass("ui-checkbox-on")?u.val(1):u.val(0),l.find(".ui-checkbox").hasClass("ui-checkbox-on")?p.val(b):p.val(0),c.find(".js-thirdpay").each(function(){var e=$(this);e.find(".ui-checkbox").hasClass("ui-checkbox-on")&&(a=e.data("payname"))}),$.ajax({url:"/pay/payout/",type:"GET",dataType:"json",beforeSend:function(){r.val("处理中...").attr("disabled",!0)},data:{orderId:y,payType:a,payGold:u.val(),payRedpackage:p.val()}}).done(function(a){e.handleData(a)}).always(function(){r.val(r.data("value")).attr("disabled",!1)}),!1})},clearSelfPay:function(){h/100>=v&&d.find(".ui-checkbox").hasClass("ui-checkbox-on")&&d.find(".ui-checkbox").removeClass("ui-checkbox-on"),f>=v&&l.find(".ui-checkbox").hasClass("ui-checkbox-on")&&l.find(".ui-checkbox").removeClass("ui-checkbox-on")},clearThirdPay:function(){t.find(".ui-checkbox").removeClass("ui-checkbox-on"),s.find(".ui-checkbox").removeClass("ui-checkbox-on")},changePayType:function(){var e=this,a=d.find(".ui-checkbox").hasClass("ui-checkbox-on")&&h>=100?h:0,i=l.find(".ui-checkbox").hasClass("ui-checkbox-on")?f:0,o=(a-a%100)/100+i;o=o>v?v:o;var n=v-o;$("#discount").html(e.toMoney(o)),$("#needPay").html(e.toMoney(n)),t.find(".ui-checkbox").hasClass("ui-checkbox-on")||s.find(".ui-checkbox").hasClass("ui-checkbox-on")||o>=v?r.attr({disabled:!1}).removeClass("button-disabled"):r.attr({disabled:!0}).addClass("button-disabled")},toMoney:function(e){return"number"!=typeof e&&(e-=0),isNaN(e)?"":e.toFixed(2)},handleData:function(e){function a(){c.checkPay(function(e){e.status&&e.data&&e.data.url&&(window.clearInterval(f),window.location.href=e.data.url)})}function i(e){var a;0>=e?(clearInterval(f),a&&clearTimeout(a)):(e--,a=setTimeout(function(){i(e)},1e3))}var c=this,t=e.data;if(e.status)switch(t.payType){case 1:if(self==top)t.choosePay.success=function(e){function a(){c.checkPay(function(e){e.status&&e.data&&e.data.url&&(window.clearInterval(o),window.top.location.href=e.data.url)})}console.log("choosePaySuccess:"),console.log(e);var i='<div class="waiting-pay-result">													    <div class="inner">													        <p class="pic"><img src="'+PageConfig.imgUrl+'h/public/grey-loading.gif" alt="loading" /></p>													        <p class="tit">微信支付成功</p>													        <p>正在等待充值到游戏...</p>													    </div>													</div>';$("body").append(i);var o=window.setInterval(a,1e3)},wx.config(t.wxConfig),wx.error(function(e){console.log(e)}),wx.chooseWXPay(t.choosePay);else{var s={};s.method="pay",s.orderId=y,s.params=t.choosePay,window.parent.postMessage(JSON.stringify(s),"/")}break;case 2:if(x.indexOf("micromessenger")>-1){var d='<div id="crossPayCode" class="cross-pay-code">												    	<div class="inner">													        <div class="title"><div class="close"></div>扫描二维码支付</div>													        <div class="code"><img class="code-pic" src="'+t.url+'" alt="二维码"></div>													        <div class="tip">长按图片 识别二维码 支付</div>													    </div>													</div>',l=self==top?$("body"):$("body",parent.document);l.append(d);var u=self==top?$("#crossPayCode"):l.find("#crossPayCode");u.on("click",".close",function(){return u.remove(),!1}),u.on("touchstart",".code-pic",function(){u.find(".btn-wrap").length||u.find(".inner").append('<div class="btn-wrap"><a class="btn" href="javascript:;">已经支付成功</a></div>')}),u.on("click",".btn",function(){return c.checkPay(function(e){if(e.status)e.data&&e.data.url&&(window.top.location.href=e.data.url);else if(self==top)o.fire("fail",e.errmsg);else{var a=$("#tipBox",parent.document);a[0]&&a.remove();var i='<div id="tipBox" class="mod-tip-box"><div class="tip-box-inner"><div class="tip-box-content"><span class="icon fail"></span><span class="txt">'+e.errmsg+"</span></div></div></div>";$("body",parent.document).append(i),$("#tipBox",parent.document).stop().show().delay(2e3).fadeOut(500,function(){$(this).remove()})}}),!1})}else{var p='<div class="mod-wx-code">							        <p><img class="wxpay-code" src="'+t.url+'" alt="二维码"></p>							        <p><img class="wxpay-tip" src="http://static.youlaohu.com/image/h/pay/wx-tip.png" alt="请使用微信扫描二维码以完成支付"></p></div>';n.open({title:"温馨提示",content:p,btn:["确定"],yes:function(){window.location.reload()}});var h=3600,f=window.setInterval(a,3e3);i(h)}break;case 3:t.url&&(window.top.location.href=t.url);break;case 4:t.url&&(window.location.href=t.url)}else r.val(r.data("value")).attr("disabled",!1),e.errmsg&&n.open({title:"错误提醒",content:e.errmsg,btn:["确定"]})},checkPay:function(e){$.ajax({url:"/pay/stat/",type:"GET",dataType:"json",data:{order_id:y}}).done(function(a){"function"==typeof e&&e(a)})}};k.init()}),define("h/public/tipFun",[],function(e,a,i){a.fire=function(e,a,i,o){$.isFunction(i)?(o=i,i=2e3):(i=i||2e3,o=o||function(){});var n=$("#tipBox");n[0]&&n.remove();var c='<div id="tipBox" class="mod-tip-box"><div class="tip-box-inner"><div class="tip-box-content"><span class="icon '+e+'"></span><span class="txt">'+a+"</span></div></div></div>";$("body").append(c),$("#tipBox").stop().show().delay(i).fadeOut(500,function(){$(this).remove(),"function"==typeof o&&o()})}}),define("h/plugins/dialog",[],function(e,a,i){function o(e){var a=this;a.config=$.extend({},n,e),a.view()}var n={shade:!0,shadeClose:!1,title:"提示信息",content:"",btn:["确定","取消"]},c={open:function(e){new o(e)},close:function(){var e=$("#"+t[0]);e[0]&&e.remove()}},t=["mod-dialog"];o.prototype.view=function(){c.close();var e=this,a=e.config,i=a.shade?$('<div id="'+t[0]+'" class="'+t[0]+' dialogshade" '+("string"==typeof a.shade?'style="'+a.shade+'"':"")+"></div>"):$('<div id="'+t[0]+'" class="'+t[0]+'"></div>'),o=function(){var e="object"==typeof a.title;return a.title?'<div class="title" style="'+(e?a.title[1]:"")+'">'+(e?a.title[0]:a.title)+"</div>":""}(),n=function(){"string"==typeof a.btn&&(a.btn=[a.btn]);var e=a.btn.length,i="";return 0!==e&&a.btn?(i='<a class="yes" type="1" href="javascript:;">'+a.btn[0]+"</a>",2===e&&(i='<a class="cancel" type="0" href="javascript:;">'+a.btn[1]+"</a>"+i),'<div class="btns">'+i+"</div>"):""}(),s='<div class="dialog-inner"><div class="dialog-main">'+o+'<div class="disc">'+a.content+"</div>"+n+"</div></div>";i.html(s),$("body").append(i);var d=$("#"+t[0]);a.success&&a.success(),e.action(a,d)},o.prototype.action=function(e,a){function i(){e.cancel&&e.cancel(),c.close()}e.shade&&e.shadeClose&&a.on("click",function(e){"mod-dialog"==e.target.id&&c.close()}),a.on("touchmove",function(e){e.preventDefault()}),a.find(".btns").children("a").on("click",function(){var a=$(this).attr("type");1==a?e.yes?e.yes():c.close():0==a&&i()})},i.exports=c});