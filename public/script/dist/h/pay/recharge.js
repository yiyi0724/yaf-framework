define("h/pay/recharge",["../public/list.regexp","../public/tipFun","../plugins/dialog"],function(t,e,a){function i(t){l.open({title:"错误提醒",content:t,btn:["确定"]})}function n(t,e){$.ajax({url:"/pay/stat/",type:"GET",dataType:"json",data:{order_id:t}}).done(function(t){"function"==typeof e&&e(t)})}function o(t){function e(){n(o,function(t){t.status&&t.data&&t.data.url&&(window.clearInterval(u),window.location.href=t.data.url)})}function a(t){var e;0>=t?(clearInterval(u),e&&clearTimeout(e)):(t--,e=setTimeout(function(){a(t)},1e3))}var i=t.data;if(t.status){var o=i.order_id;switch(i.type){case"wxjspay":i.choosePay.success=function(t){function e(){n(o,function(t){t.status&&t.data&&t.data.url&&(window.location.href=t.data.url)})}console.log("choosePaySuccess:"),console.log(t);var a='<div class="waiting-pay-result">                                                        <div class="inner">                                                            <p class="pic"><img src="'+PageConfig.imgUrl+'h/public/grey-loading.gif" alt="loading" /></p>                                                            <p class="tit">微信支付成功</p>                                                            <p>正在跳转...</p>                                                        </div>                                                    </div>';$("body").append(a);window.setInterval(e,1e3)},wx.config(i.wxConfig),wx.error(function(t){console.log(t)}),wx.chooseWXPay(i.choosePay);break;case"wxpay":if(y.indexOf("micromessenger")>-1){var s='<div id="crossPayCode" class="cross-pay-code">                                                    <div class="inner">                                                        <div class="title"><div class="close"></div>扫描二维码支付</div>                                                        <div class="code"><img class="code-pic" src="'+i.url+'" alt="二维码" /></div>                                                        <div class="tip">长按图片 识别二维码 支付</div>                                                    </div>                                                </div>';$("body").append(s);var r=$("#crossPayCode");r.on("click",".close",function(){return r.remove(),!1}),r.on("touchstart",".code-pic",function(){r.find(".btn-wrap").length||r.find(".inner").append('<div class="btn-wrap"><a class="btn" href="javascript:;">已经支付成功</a></div>')}),r.on("click",".btn",function(){return n(o,function(t){t.status?t.data&&t.data.url&&(window.location.href=t.data.url):c.fire("fail",t.errmsg)}),!1})}else{var d='<div class="mod-wx-code">                                    <p><img class="wxpay-code" src="'+i.url+'" alt="二维码"></p>                                    <p><img class="wxpay-tip" src="http://static.youlaohu.com/image/h/pay/wx-tip.png" alt="请使用微信扫描二维码以完成支付"></p></div>';l.open({title:"温馨提示",content:d,btn:["确定"],yes:function(){window.location.reload()}});var p=3600,u=window.setInterval(e,3e3);a(p)}break;case"alipay":i.url&&(window.top.location.href=i.url)}}else h.val(h.data("value")).attr("disabled",!1),9e3==t.errno&&i.hasOwnProperty("url")&&i.url?l.open({title:"错误提醒",content:t.errmsg,btn:["确定"],yes:function(){window.location.href=i.url}}):t.errmsg&&l.open({title:"错误提醒",content:t.errmsg,btn:["确定"]})}var s=t("../public/list.regexp"),c=t("../public/tipFun"),l=t("../plugins/dialog"),r=$("#payList"),d=$("#amountList"),p=$("#otherAmount"),u=$("#hidPrice"),v=$("#iAmount"),f=$("#iCoin"),h=$("#submitBtn"),m=$.trim(d.find(".active").children(".amount").text()),y=navigator.userAgent.toLowerCase();v.html(m),f.html(100*m),d.on("click",".amount-item",function(){var t=$(this),e=parseInt(t.attr("price"),10);if(t.addClass("active").siblings().removeClass("active"),0==e){var a=$.trim(p.val());p.focus().attr("placeholder",""),s.positiveNum.test(a)?(v.html(a),f.html(100*a),u.val(a)):(v.html(""),f.html(""),u.val(0))}else v.html(e),f.html(100*e),u.val(e),p.val("");return!1}),p.on({blur:function(){p.attr("placeholder","其他金额")},"input propertychange":function(){var t=$.trim(p.val());if(s.positiveNum.test(t)){var e=100*t;v.html(t),f.html(e),u.val(t)}else v.html(""),f.html(""),u.val(0)}}),r.on("click",".pay-item",function(){var t=$(this);return t.addClass("selected").siblings().removeClass("selected"),!1}),h.on("click",function(){var t=u.val(),e=$("#payList").find(".selected").data("payname")||"";return e?s.positiveNum.test(t)?parseInt(t)<10?(i("充值金额不能小于10元"),!1):($.ajax({url:"/pay/payin/",type:"GET",dataType:"json",beforeSend:function(){h.val("处理中...").attr("disabled",!0)},data:{price:t,payType:e}}).done(function(t){o(t)}).always(function(){h.val(h.data("value")).attr("disabled",!1)}),!1):(i("请选择或输入充值金额"),!1):(i("请选择支付方式"),!1)})}),define("h/public/list.regexp",[],{email:/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,code:/^\d{4}$/,zipcode:/^[0-9]{6}$/,mobilephone:/^1[3-9][0-9]{9}$/,areacode:/^\d{3,6}$/,tel:/^\d{7,8}$/,ext:/\d{3,}$/,captcha:/^\w{4}$/,username:/^[a-zA-Z][a-zA-Z0-9_\-]*$/,password:/^[a-zA-Z0-9_!@#\$%\^&\*\(\)\\\|\/\?\.\<\>'"\{\}\[\]=\-\+\~\,\;\:\s]+$/,chinese:/^[\u4e00-\u9fa5]+$/,link:/^(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;\+#]*[\w\-\@?^=%&amp;\+#])?/,qq:/^[1-9][0-9]{4,}$/,regPrice:/^[0-9]+([.]{1}[0-9]{1,2})?$/,positiveNum:/^[1-9]\d*$/,allNumber:/^\d+$/,allLetter:/^[a-zA-Z]+$/,symbols:/[_!@#\$%\^&\*\(\)\\\|\/\?\.\<\>'"\{\}\[\]=\-\+\~\,\;\:\s]+/,allSame:/^([\s\S])\1*$/,allLetterSame:/^([a-zA-Z])\1*$/,lowerLetter:/[a-z]+/,upperLetter:/[A-Z]+/,hasSpace:/\s/}),define("h/public/tipFun",[],function(t,e,a){e.fire=function(t,e,a,i){$.isFunction(a)?(i=a,a=2e3):(a=a||2e3,i=i||function(){});var n=$("#tipBox");n[0]&&n.remove();var o='<div id="tipBox" class="mod-tip-box"><div class="tip-box-inner"><div class="tip-box-content"><span class="icon '+t+'"></span><span class="txt">'+e+"</span></div></div></div>";$("body").append(o),$("#tipBox").stop().show().delay(a).fadeOut(500,function(){$(this).remove(),"function"==typeof i&&i()})}}),define("h/plugins/dialog",[],function(t,e,a){function i(t){var e=this;e.config=$.extend({},n,t),e.view()}var n={shade:!0,shadeClose:!1,title:"提示信息",content:"",btn:["确定","取消"]},o={open:function(t){new i(t)},close:function(){var t=$("#"+s[0]);t[0]&&t.remove()}},s=["mod-dialog"];i.prototype.view=function(){o.close();var t=this,e=t.config,a=e.shade?$('<div id="'+s[0]+'" class="'+s[0]+' dialogshade" '+("string"==typeof e.shade?'style="'+e.shade+'"':"")+"></div>"):$('<div id="'+s[0]+'" class="'+s[0]+'"></div>'),i=function(){var t="object"==typeof e.title;return e.title?'<div class="title" style="'+(t?e.title[1]:"")+'">'+(t?e.title[0]:e.title)+"</div>":""}(),n=function(){"string"==typeof e.btn&&(e.btn=[e.btn]);var t=e.btn.length,a="";return 0!==t&&e.btn?(a='<a class="yes" type="1" href="javascript:;">'+e.btn[0]+"</a>",2===t&&(a='<a class="cancel" type="0" href="javascript:;">'+e.btn[1]+"</a>"+a),'<div class="btns">'+a+"</div>"):""}(),c='<div class="dialog-inner"><div class="dialog-main">'+i+'<div class="disc">'+e.content+"</div>"+n+"</div></div>";a.html(c),$("body").append(a);var l=$("#"+s[0]);e.success&&e.success(),t.action(e,l)},i.prototype.action=function(t,e){function a(){t.cancel&&t.cancel(),o.close()}t.shade&&t.shadeClose&&e.on("click",function(t){"mod-dialog"==t.target.id&&o.close()}),e.on("touchmove",function(t){t.preventDefault()}),e.find(".btns").children("a").on("click",function(){var e=$(this).attr("type");1==e?t.yes?t.yes():o.close():0==e&&a()})},a.exports=o});