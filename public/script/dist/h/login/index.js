define("h/login/index",["../public/list.regexp","../public/tipFun","../plugins/dialog","../public/time.count","../plugins/jquery.tabs"],function(t,e,a){function n(t){c.open({title:"错误提醒",content:t,btn:["确定"]})}function s(t,e){var a=u[t](e);return a.status||n(a.msg),a}function i(t){var e=t.ele;if(e.data("progress"))return!1;if(e.is($("#sendcode"))){var a={mobile:t.validateEle.mobile,captcha:t.validateEle.captcha};for(var i in a)if(!s(i,a[i]).status)return!1}$.ajax({url:"/sender/sms/",type:"GET",dataType:"json",data:t.data}).done(function(a){a.status?l(e,60,function(t){t>0?e.html("重新发送短信（"+t+"）"):e.html("重新发送")}):a.errmsg&&(n(a.errmsg),t.validateEle.captcha.siblings(".captcha-wrap").trigger("click"))})}var r=t("../public/list.regexp"),o=t("../public/tipFun"),c=t("../plugins/dialog"),l=t("../public/time.count").countdown,d=$("#redirectUri").val(),u={mobile:function(t){var e=$.trim(t.val()),a={obj:t,status:!0,msg:""};return r.mobilephone.test(e)||(a.status=!1,a.msg="请输入正确的手机号码"),a},user:function(t){var e=$.trim(t.val()),a={obj:t,status:!0,msg:""};return t.is($("#lUser"))?e||(a.status=!1,a.msg="请输入用户名或手机号"):t.is($("#rUser"))&&(r.mobilephone.test(e)||(e?e.length<4||e.length>20?(a.status=!1,a.msg="账号长度只能在4-20个字符之间"):r.username.test(e)||(a.status=!1,a.msg="账号以英文字母开头，支持字母、数字、下划线(_)或横杠(-)的组合"):(a.status=!1,a.msg="请输入用户名或手机号"))),a},password:function(t){var e=t.val(),a={obj:t,status:!0,msg:""};return t.is($("#lPassword"))?e||(a.status=!1,a.msg="请输入密码"):t.is($("#rPassword"))&&(e?e.length<6?(a.status=!1,a.msg="密码至少6位以上"):r.hasSpace.test(e)?(a.status=!1,a.msg="密码不能有空格"):r.allNumber.test(e)?(a.status=!1,a.msg="密码不能为纯数字"):r.allLetterSame.test(e)?(a.status=!1,a.msg="密码不能为相同的字母组成"):r.password.test(e)||(a.status=!1,a.msg="密码只能由英文、数字及符号组成"):(a.status=!1,a.msg="请输入密码")),a},captcha:function(t){var e=$.trim(t.val()),a={obj:t,status:!0,msg:""};return(""==e||4!=e.length)&&(a.status=!1,a.msg="请输入正确的验证码"),a},code:function(t){var e=$.trim(t.val()),a={obj:t,status:!0,msg:""};return r.code.test(e)||(a.status=!1,a.msg="请输入正确的短信验证码"),a}};!function(){var t=$("#formUserLogin"),e=$("#formCodeLogin");$("#toCodeLogin").on("click",function(){return t.addClass("hide"),e.removeClass("hide"),!1}),$("#toUserLogin").on("click",function(){return t.removeClass("hide"),e.addClass("hide"),!1})}(),function(){var t=$("#lUser"),e=$("#lPassword"),a=$("#lUserCaptcha"),i=$("#userLoginBtn"),r=$("#formUserLogin").attr("data-captcha")||!1;i.on("click",function(){if(i.hasClass("button-disabled"))return!1;var o=!0,c={user:t,password:e},l={username:$.trim(t.val()),password:e.val(),redirectUri:d};r&&(c.captcha=a,l.captcha=$.trim(a.val()));for(var u in c)if(!s(u,c[u]).status)return o=!1;return o&&$.ajax({url:"/member/api/ulogin/",type:"POST",dataType:"json",beforeSend:function(){i.addClass("button-disabled")},data:l}).done(function(t){if(t.status)t.data&&t.data.url&&(window.location.href=t.data.url);else{if(t.data.hasOwnProperty("use_captcha")&&t.data.use_captcha){var e=$("#lUserCaptchaWrap");0==r?e.parent().removeClass("hide").find("img").attr("src","/image/captcha/?c=ulogin&t="+(new Date).getTime()):e.trigger("click"),r=!0}t.errmsg&&n(t.errmsg)}}).always(function(){i.removeClass("button-disabled")}),!1})}(),function(){var t=$("#mobile"),e=$("#codeCaptcha"),a=$("#lCode"),r=$("#codeLoginBtn");r.on("click",function(){if(r.hasClass("button-disabled"))return!1;var i=!0,o={mobile:t,captcha:e,code:a},c={username:$.trim(t.val()),captcha:$.trim(e.val()),code:$.trim(a.val()),redirectUri:d};for(var l in o)if(!s(l,o[l]).status)return i=!1;return i&&$.ajax({url:"/member/api/mlogin/",type:"POST",dataType:"json",beforeSend:function(){r.addClass("button-disabled")},data:c}).done(function(t){t.status?t.data&&t.data.url&&(window.location.href=t.data.url):t.errmsg&&n(t.errmsg)}).always(function(){r.removeClass("button-disabled")}),!1}),$("#sendcode").click(function(){var t=$("#mobile"),e=$("#codeCaptcha"),a={ele:$(this),validateEle:{mobile:t,captcha:e},data:{phonenumber:$.trim(t.val()),captcha:$.trim(e.val()),channel:"mlogin"}};return i(a),!1})}(),function(){var t=$("#rUser"),e=$("#rPassword"),a=$("#rUserCaptcha"),r=$("#resend"),c=$("#regBtn"),u=$("#doneBtn");c.on("click",function(){if(c.hasClass("button-disabled"))return!1;var i=!0,u={user:t,password:e,captcha:a},p={username:$.trim(t.val()),password:e.val(),captcha:$.trim(a.val()),redirectUri:d};for(var f in u)if(!s(f,u[f]).status)return i=!1;return i&&$.ajax({url:"/member/api/reg/",type:"POST",dataType:"json",beforeSend:function(){c.addClass("button-disabled")},data:p}).done(function(e){e.status?e.data.hasOwnProperty("sms")&&e.data.sms?($("#sendToMobile").html($.trim(t.val()).replace(/(\d{3})(\d{5})(\d{2})/,"$1*****$3")),$("#formReg").addClass("hide"),$("#codeSendForm").removeClass("hide"),l(r,60,function(t){t>0?r.html("重新发送短信（"+t+"）"):r.html("重新发送")})):o.fire("success",e.errmsg||"注册成功",function(){e.data&&e.data.url&&(window.location.href=e.data.url)}):(e.errmsg&&n(e.errmsg),a.siblings(".captcha-wrap").trigger("click"))}).always(function(){c.removeClass("button-disabled")}),!1}),r.click(function(){var e={ele:r,data:{phonenumber:$.trim(t.val()),channel:"ureg"}};return i(e),!1}),u.on("click",function(){if(u.hasClass("button-disabled"))return!1;var t=$("#rCode"),e=!0;return s("code",t).status?(e&&$.ajax({url:"/member/api/reg/",type:"POST",dataType:"json",beforeSend:function(){u.addClass("button-disabled")},data:{code:$.trim(t.val()),redirectUri:d}}).done(function(t){t.status?o.fire("success",t.errmsg||"注册成功",function(){t.data&&t.data.url&&(window.location.href=t.data.url)}):t.errmsg&&n(t.errmsg)}).always(function(){u.removeClass("button-disabled")}),!1):e=!1})}(),function(){t("../plugins/jquery.tabs");var e=$("#tabsMain"),a=e.find(".js-tabs .active").index();e.tabs({navCls:"js-tabs",contentCls:"js-panels",triggerType:"click",activeIndex:a})}(),function(){var t=!0;$(".js-show-pwd").on("click",function(){var e=$(this);return t?e.addClass("show-pwd-on").siblings(".input-model").attr("type","text"):e.removeClass("show-pwd-on").siblings(".input-model").attr("type","password"),t=!t,!1})}(),function(){$(".captcha-wrap").click(function(){var t=$(this),e=t.find("img"),a=e.attr("src"),n=/t=\d*/;return a=n.test(a)?a.replace(n,"t="+(new Date).getTime()):a+(a.indexOf("?")>-1?"&":"?")+"t="+(new Date).getTime(),e.attr("src",a),t.siblings(".input-model").val(""),!1})}()}),define("h/public/list.regexp",[],{email:/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,code:/^\d{4}$/,zipcode:/^[0-9]{6}$/,mobilephone:/^1[3-9][0-9]{9}$/,areacode:/^\d{3,6}$/,tel:/^\d{7,8}$/,ext:/\d{3,}$/,captcha:/^\w{4}$/,username:/^[a-zA-Z][a-zA-Z0-9_\-]*$/,password:/^[a-zA-Z0-9_!@#\$%\^&\*\(\)\\\|\/\?\.\<\>'"\{\}\[\]=\-\+\~\,\;\:\s]+$/,chinese:/^[\u4e00-\u9fa5]+$/,link:/^(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;\+#]*[\w\-\@?^=%&amp;\+#])?/,qq:/^[1-9][0-9]{4,}$/,regPrice:/^[0-9]+([.]{1}[0-9]{1,2})?$/,positiveNum:/^[1-9]\d*$/,allNumber:/^\d+$/,allLetter:/^[a-zA-Z]+$/,symbols:/[_!@#\$%\^&\*\(\)\\\|\/\?\.\<\>'"\{\}\[\]=\-\+\~\,\;\:\s]+/,allSame:/^([\s\S])\1*$/,allLetterSame:/^([a-zA-Z])\1*$/,lowerLetter:/[a-z]+/,upperLetter:/[A-Z]+/,hasSpace:/\s/}),define("h/public/tipFun",[],function(t,e,a){e.fire=function(t,e,a,n){$.isFunction(a)?(n=a,a=2e3):(a=a||2e3,n=n||function(){});var s=$("#tipBox");s[0]&&s.remove();var i='<div id="tipBox" class="mod-tip-box"><div class="tip-box-inner"><div class="tip-box-content"><span class="icon '+t+'"></span><span class="txt">'+e+"</span></div></div></div>";$("body").append(i),$("#tipBox").stop().show().delay(a).fadeOut(500,function(){$(this).remove(),"function"==typeof n&&n()})}}),define("h/plugins/dialog",[],function(t,e,a){function n(t){var e=this;e.config=$.extend({},s,t),e.view()}var s={shade:!0,shadeClose:!1,title:"提示信息",content:"",btn:["确定","取消"]},i={open:function(t){new n(t)},close:function(){var t=$("#"+r[0]);t[0]&&t.remove()}},r=["mod-dialog"];n.prototype.view=function(){i.close();var t=this,e=t.config,a=e.shade?$('<div id="'+r[0]+'" class="'+r[0]+' dialogshade" '+("string"==typeof e.shade?'style="'+e.shade+'"':"")+"></div>"):$('<div id="'+r[0]+'" class="'+r[0]+'"></div>'),n=function(){var t="object"==typeof e.title;return e.title?'<div class="title" style="'+(t?e.title[1]:"")+'">'+(t?e.title[0]:e.title)+"</div>":""}(),s=function(){"string"==typeof e.btn&&(e.btn=[e.btn]);var t=e.btn.length,a="";return 0!==t&&e.btn?(a='<a class="yes" type="1" href="javascript:;">'+e.btn[0]+"</a>",2===t&&(a='<a class="cancel" type="0" href="javascript:;">'+e.btn[1]+"</a>"+a),'<div class="btns">'+a+"</div>"):""}(),o='<div class="dialog-inner"><div class="dialog-main">'+n+'<div class="disc">'+e.content+"</div>"+s+"</div></div>";a.html(o),$("body").append(a);var c=$("#"+r[0]);e.success&&e.success(),t.action(e,c)},n.prototype.action=function(t,e){function a(){t.cancel&&t.cancel(),i.close()}t.shade&&t.shadeClose&&e.on("click",function(t){"mod-dialog"==t.target.id&&i.close()}),e.on("touchmove",function(t){t.preventDefault()}),e.find(".btns").children("a").on("click",function(){var e=$(this).attr("type");1==e?t.yes?t.yes():i.close():0==e&&a()})},a.exports=i}),define("h/public/time.count",[],function(t,e,a){e.countdown=function(t,e,a){"number"!=typeof e&&(a=e,e=60),t.data("progress",!0).addClass("button-disabled"),a(--e);var n=setInterval(function(){--e<=0&&(t.data("progress",!1).removeClass("button-disabled"),clearInterval(n),n=null),a(e)},1e3);t.data("time",n)}}),define("h/plugins/jquery.tabs",[],function(t,e,a){!function(t){t.fn.tabs=function(e,a){"function"==typeof e?(a=e,e={}):(e=e||{},a=a||function(){});var n={contentCls:"content",navCls:"nav",activeCls:"active",triggerType:"mouse",triggerCondition:"*",activeIndex:0,beforeEvent:function(){},afterEvent:function(){}},s=t.extend({},n,e);return this.each(function(){var e=t(this),n=e.find("."+s.contentCls).children(),i=e.find("."+s.navCls+">"+s.triggerCondition),r={};s.triggerType+="mouse"===s.triggerType?"enter":"",r.select=function(t){i.removeClass(s.activeCls).eq(t).addClass(s.activeCls),n.hide().eq(t).show()},r.select(s.activeIndex),i.data("curr",i.siblings("."+s.activeCls).index()).on(s.triggerType,function(a){var o=i.data("curr"),c=i.index(t(this));if(o!==c){i.data("curr",c);var l={target:e,triggers:i,panels:n,index:c,event:a};0!=s.beforeEvent(l)&&(r.select(c),s.afterEvent(l))}}),a(r)})}}(jQuery)});